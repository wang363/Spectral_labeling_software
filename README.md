# 光谱标记软件

## 一、软件概述  
这是一款基于 PyQt5 和 Matplotlib 开发的光谱数据处理工具，主要用于拉曼光谱数据的可视化、**手动**基线扣除、峰拟合（Voigt 拟合）及数据导出等操作。软件通过两个核心绘图区域（Spectra Plot 和 Voigt Plot）实现数据处理流程，适用于科研人员对拉曼光谱数据进行深入分析。  

**下载地址：**  
通过网盘分享的文件：RamanLabeler
链接: https://pan.baidu.com/s/1kHRw2KKZKXuoJJ74fnP1yg?pwd=ntei    
提取码: ntei   
--来自百度网盘超级会员v7的分享  
![软件存储与依赖](https://gitee.com/cjlu-wzl/project_/raw/master/软件.png)  
### 注意
exe文件初次加载时较慢，请耐心等待，不要将exe文件进行移动，否则无法获取_internal文件夹中的依赖，建议通过创建快捷方式的形式打开

## 二、核心功能模块

### 1. 光谱数据可视化与基线处理（Spectra Plot标签页）
主要用于原始光谱数据的展示、基线校正及预处理，支持以下功能：

#### （1）文件操作
- **数据导入**：支持CSV格式的光谱数据文件导入（至少包含两列，分别为波数和强度），导入后自动进行插值处理，将波数转换为间隔为 1 的整数序列，便于后续分析。
- **数据重置**：可一键清空当前光谱数据及所有处理结果（如基线、去基线数据等）。

#### （2）基线校正
- **基线点选取**：支持手动选点模式，通过鼠标在光谱图上点击选取基线参考点（至少 2 个点），选点后自动按 x 轴排序，便于基线拟合。
- **基线点管理**：可删除最后一个选中的基线点，或重置所有基线点。
- **基线处理**：
  - 手动标记基线点（支持添加、删除、重置操作）
  - 基于标记点进行基线拟合与扣除
- **基线计算与扣除**：基于选中的基线点，通过插值计算基线曲线，并自动生成去基线数据（原始数据减去基线），支持实时可视化对比。

#### （3）视图控制
- **可视化交互**：
  - 可切换显示原始数据、基线、去基线数据
  - 鼠标移动时自动显示竖直线及与光谱的交点
  - 实时显示交点坐标
  - 支持视图缩放（放大/缩小/重置）

#### （4）数据导出
支持导出多种预处理后的数据，包括：
- 原始光谱数据（未处理）
- 基线校正后的数据（含原始强度、去基线强度、基线值）
- 归一化原始数据（按原始强度归一化到 [0,1] 范围）
- 基线校正后的归一化数据（按去基线强度归一化到 [0,1] 范围）

---

### 2. Voigt峰拟合分析（Voigt Plot标签页）
专注于光谱峰的拟合分析，支持基于 Voigt 函数的单峰 / 多峰拟合，功能包括：

#### （1）数据来源
- **文件导入**：直接导入 CSV格式数据，自动归一化后用于拟合。
- **数据传递**：可接收来自 Spectra Plot 的**基线校正**后数据（自动归一化），实现数据处理流程的连贯性。

#### （2）Voigt 拟合功能
- **单峰拟合**：通过手动输入拟合参数（振幅 amp、峰位 pos、半高全宽 fwhm、基线值 y0、形状参数 shape），生成单峰 Voigt 拟合曲线并可视化。y0和shape分别默认为0和1，建议不用修改这两个参数。
- **多峰整体拟合**：支持添加多个峰参数（通过表格管理），计算所有分峰的 Voigt 曲线及总和曲线，实现多峰叠加拟合，分峰曲线以不同颜色区分显示。
- **光谱解混模型拟合**： 支持基于预训练深度学习模型的自动拟合，自动识别光谱峰位置并生成拟合曲线，提升拟合效率。

#### （3）参数管理
拟合参数通过表格（TableView）可视化管理，支持添加新峰参数、删除选中的峰参数行，便于调整多峰拟合模型。

#### （4）数据导出
支持导出 Voigt 拟合结果数据，便于后续分析或报告生成。导出包含拉曼位移、归一化强度、峰位置、振幅、半高全宽的拟合数据


## 简要使用流程
1. 通过顶部"文件"菜单导入光谱数据
2. 在Spectra Plot标签页完成基线标记与扣除
3. 切换到Voigt Plot标签页，设置峰参数并执行手动或模型自动拟合
4. 使用对应按钮导出所需数据结果



## 依赖库
#### 可自行运行Ui_main.py进行计算
- PyQt5：GUI界面框架
- Matplotlib：数据可视化
- Pandas：数据处理
- NumPy：数值计算
- Torch：Voigt函数计算
- SciPy：科学计算支持  

##  界面部分展示
1. ![文件导入功能](https://gitee.com/cjlu-wzl/project_/raw/master/Project_Manual_label/文件导入.png)  
- 'Open File'用于向"Spectra Plot"选项卡导入数据
- 'Open File for Voigt Plot'用于向"Voigt Plot"选项卡导入数据
2. ![Spectra Plot界面功能展示](https://gitee.com/cjlu-wzl/project_/raw/master/Project_Manual_label/Spectra_plot.png)
- 当"Spectra Plot"界面进行手动基线去除后，无论有没有使用'Open File for Voigt Plot'导入数据，"Voigt Plot"将自动展示去除基线后的曲线
3. ![Voigt Plot界面功能展示](https://gitee.com/cjlu-wzl/project_/raw/master/Voigt_Plot_1.png) 
4. ![Voigt Plot界面功能展示](https://gitee.com/cjlu-wzl/project_/raw/master/Voigt_Plot_2.png)
- 点击“模型拟合”按钮即可进行自动Voigt拟合，可以导出拟合后的各项参数信息
```
# 参数信息如下
data_to_export = pd.DataFrame({
                        'Raman Shift': raman_shift,
                        '归一化强度': raw_intensity,
                        '位置(pos)': pos_col,
                        '振幅': amp_col,
                        '半宽全高': fwhm_col
                    })
```

